<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />
  <meta name="theme-color" content="#0b0f18" />
  <title>daugia.vin — Đấu giá VIN minh bạch trên blockchain</title>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="vin64.png?v=1">
  <link rel="icon" type="image/png" sizes="64x64" href="vin64.png?v=1">
  <link rel="apple-touch-icon" sizes="128x128" href="vin128.png?v=1">
  <link rel="shortcut icon" href="vin64.png?v=1">

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ========= App Config (đọc bởi app.js) ========= -->
  <script id="app-config" type="application/json">
  {
    "CHAIN_ID_DEC": 88,
    "CHAIN_ID_HEX": "0x58",
    "RPC_URL": "https://rpc.viction.xyz",
    "EXPLORER": "https://vicscan.xyz",
    "CONTRACTS": {
      "AUCTION": "0x1765e20ecB8cD78688417A6d4123f2b899775599",
      "VIN":     "0x941F63807401efCE8afe3C9d88d368bAA287Fac4"
    },
    "LINKS": {
      "SWAP": "https://ipfs.io/ipfs/bafybeigooqte3w5m3rok2r7c5czep2flsfeocwjpzzid3vxszdyib3rjpi",
      "SOURCE": "#"
    }
  }
  </script>

  <!-- ========= Topbar ========= -->
  <header class="topbar" role="banner">
    <div class="brand-wrap">
      <button id="menu-toggle" class="icon-btn" aria-label="Mở menu">☰</button>
      <img id="logo-main" src="vin128.png" alt="VIN" width="40" height="40" />
      <div class="brand">
        <h1 class="brand-title">daugia.vin</h1>
        <p class="brand-sub">daugia.vin — Đấu giá VIN minh bạch trên blockchain</p>
      </div>
    </div>

    <!-- Ô tìm kiếm trung tâm -->
    <div class="search-center" role="search">
      <input id="search-input" class="input" type="text" placeholder="Tìm theo tên/mô tả/mã hồ sơ/địa chỉ ví…" />
      <button id="btn-search" class="btn" aria-label="Tìm kiếm">Tìm</button>
    </div>

    <!-- Menu phải (desktop) -->
    <nav class="menu-right" aria-label="Menu">
      <!-- Hiện khi CHƯA kết nối -->
      <button id="btn-connect" class="btn primary">Kết nối ví</button>
      <a class="menu-link" href="#guide">Hướng dẫn</a>
      <div class="menu-item has-sub">
        <button class="menu-btn" aria-haspopup="true" aria-expanded="false">Tra cứu ▾</button>
        <div class="menu-dropdown" role="menu">
          <a id="link-swap" class="menu-link" role="menuitem" href="https://ipfs.io/ipfs/bafybeigooqte3w5m3rok2r7c5czep2flsfeocwjpzzid3vxszdyib3rjpi" target="_blank" rel="noopener">Swap VIN/VIC</a>
          <a id="link-auction" class="menu-link" role="menuitem" href="#" target="_blank" rel="noopener">Hợp đồng đấu giá</a>
          <a id="link-vin" class="menu-link" role="menuitem" href="#" target="_blank" rel="noopener">VIN token</a>
          <div class="separator"></div>
          <div class="menu-inline" role="menuitem">
            <span>Giá VIN:</span>
            <span id="vin-price" class="chip soft">Đang tải...</span>
          </div>
        </div>
      </div>

      <!-- Bật sau khi KẾT NỐI (app.js điều khiển) -->
      <div id="account-menu" class="menu-item has-sub hide">
        <button class="menu-btn" aria-haspopup="true" aria-expanded="false">Tài khoản ▾</button>
        <div class="menu-dropdown" role="menu">
          <button id="btn-register" class="btn hide js-hide-until-connected" role="menuitem">Đăng ký</button>
          <button id="btn-open-create" class="btn accent hide js-hide-until-registered" role="menuitem">Tạo cuộc đấu giá</button>
        </div>
      </div>

      <!-- Chip trạng thái gọn -->
      <div class="chips">
        <div class="chip" id="network-chip">VIC • <span id="net-status">Chưa kết nối</span></div>
        <div class="chip hide" id="account-chip" title="Địa chỉ ví"></div>
      </div>
    </nav>
  </header>

  <!-- Slogan (mảnh, không chiếm chỗ) -->
  <section class="mission-note" role="note">
    <p>
      <strong>Công bằng • Minh bạch • Tự động • Trên Blockchain</strong><br/>
      Vận hành 100% bằng hợp đồng thông minh, không ai có thể can thiệp.<br/>
      <em><a href="https://docs.google.com/document/d/1MH7DPggKAGPQkdC2UuD4Afm9E_QOMbOr/edit" class="mission-link" target="_blank" rel="noopener">Xem kỹ hướng dẫn sử dụng</a> trước khi tham gia.</em>
    </p>
  </section>

  <!-- ========= Drawer (mobile) ========= -->
  <aside id="drawer" class="drawer" aria-hidden="true" aria-label="Menu di động">
    <div class="drawer-header">
      <div class="drawer-title">Menu</div>
      <button class="icon-btn" id="drawer-close" aria-label="Đóng">✕</button>
    </div>

    <!-- Search (mobile) -->
    <div class="drawer-search">
      <input id="m-search-input" class="input" type="text" placeholder="Từ khóa…" />
      <button id="m-btn-search" class="btn">Tìm</button>
    </div>

    <div class="accordion">
      <details open>
        <summary>Truy cập nhanh</summary>
        <div class="drawer-group">
          <button id="m-btn-connect" class="btn primary block">Kết nối ví</button>
          <a class="menu-link block" href="#guide">Hướng dẫn</a>
          <a id="m-link-swap" class="menu-link block" href="https://ipfs.io/ipfs/bafybeigooqte3w5m3rok2r7c5czep2flsfeocwjpzzid3vxszdyib3rjpi" target="_blank" rel="noopener">Swap VIN/VIC</a>
          <a id="m-link-auction" class="menu-link block" href="#" target="_blank" rel="noopener">Hợp đồng đấu giá</a>
          <a id="m-link-vin" class="menu-link block" href="#" target="_blank" rel="noopener">VIN token</a>
          <div class="menu-inline">
            <span>Giá VIN:</span> <span id="m-vin-price" class="chip soft">Đang tải...</span>
          </div>
        </div>
      </details>

      <details id="m-account" class="hide">
        <summary>Tài khoản</summary>
        <div class="drawer-group">
          <button id="m-btn-register" class="btn hide js-hide-until-connected block">Đăng ký</button>
          <button id="m-btn-open-create" class="btn accent hide js-hide-until-registered block">Tạo cuộc đấu giá</button>
        </div>
      </details>
    </div>
  </aside>

  <!-- ========= Main Content: chỉ danh sách đấu giá ========= -->
  <main class="content" role="main">
    <div id="auction-list" class="grid">
      <!-- app.js sẽ render các thẻ đấu giá -->
      <div class="skeleton-list">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
      </div>
    </div>

    <div class="pager hide" id="pager">
      <button id="prev-page" class="btn ghost" type="button">← Trước</button>
      <span id="page-info">Trang 1</span>
      <button id="next-page" class="btn ghost" type="button">Sau →</button>
    </div>
  </main>

  <!-- ========= Modals ========= -->
  <div id="modal-create" class="modal" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="create-title">
      <div class="modal-header">
        <h3 id="create-title">Tạo cuộc đấu giá</h3>
        <button class="icon-btn" data-close="#modal-create" aria-label="Đóng">✕</button>
      </div>
      <div class="modal-body">
        <div class="form">
          <label class="label">Tên tài sản</label>
          <input id="create-name" class="input" type="text" placeholder="VD: Lô đất, ô tô, tài sản khác…" />

          <label class="label">Mô tả</label>
          <textarea id="create-desc" class="textarea" rows="3" placeholder="Thông tin súc tích, kèm mã hồ sơ nếu có"></textarea>

          <label class="label">Hình ảnh (URL)</label>
          <input id="create-img" class="input" type="url" placeholder="https://..." />

          <div class="row-2">
            <div>
              <label class="label">Giá khởi điểm (VIN)</label>
              <input id="create-start" class="input" type="number" min="0" step="0.000000000000000001" placeholder="0.0" />
            </div>
            <div>
              <label class="label">Bước giá tối thiểu (VIN)</label>
              <input id="create-step" class="input" type="number" min="0" step="0.000000000000000001" placeholder="0.1" />
            </div>
          </div>

          <div class="row-2">
            <div>
              <label class="label">Loại tài sản</label>
              <input id="create-asset-type" class="input" type="text" placeholder="VD: BĐS, Ô tô, Khác…" />
            </div>
            <div>
              <label class="label">Xã/Phường</label>
              <input id="create-ward" class="input" type="text" placeholder="VD: Phường A, Xã B…" />
            </div>
          </div>

          <label class="label">Thời điểm kết thúc</label>
          <input id="create-ends" class="input" type="datetime-local" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-close="#modal-create" type="button">Huỷ</button>
        <button id="btn-create-submit" class="btn primary" type="button">Tạo phiên</button>
      </div>
    </div>
  </div>

  <div id="modal-bid" class="modal" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="bid-title">
      <div class="modal-header">
        <h3 id="bid-title">Đặt giá</h3>
        <button class="icon-btn" data-close="#modal-bid" aria-label="Đóng">✕</button>
      </div>
      <div class="modal-body">
        <div class="form">
          <div class="pair"><span>Đang dẫn đầu:</span> <strong><span id="bid-leading">0</span> VIN</strong></div>
          <div class="pair"><span>Bước tối thiểu:</span> <strong><span id="bid-step">0</span> VIN</strong></div>
          <label class="label">Giá bạn trả (VIN)</label>
          <input id="bid-amount" class="input" type="number" min="0" step="0.000000000000000001" placeholder="Nhập số VIN" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-close="#modal-bid" type="button">Huỷ</button>
        <button id="btn-bid-submit" class="btn primary" type="button">Xác nhận đặt giá</button>
      </div>
    </div>
  </div>

  <!-- ========= Toast ========= -->
  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- Vendor -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="app.js"></script>

  <!-- Bootstrap (không đụng Web3) -->
  <script>
    (function () {
      const cfg = JSON.parse(document.getElementById('app-config').textContent.trim());
      const EXP = cfg.EXPLORER.replace(/\/+$/,'');
      const AUCTION = cfg.CONTRACTS.AUCTION;
      const VIN     = cfg.CONTRACTS.VIN;

      // Set explorer links
      const setHref = (id, url) => { const el = document.getElementById(id); if (el) el.href = url; };
      setHref('link-auction',      EXP + '/address/' + AUCTION);
      setHref('link-vin',          EXP + '/token/'   + VIN);
      setHref('link-expl-auction', EXP + '/address/' + AUCTION);
      setHref('link-expl-vin',     EXP + '/token/'   + VIN);

      // Mirror to mobile drawer
      ['m-link-auction','m-link-vin'].forEach((id, i) => {
        const el = document.getElementById(id);
        if (el) el.href = i === 0 ? (EXP + '/address/' + AUCTION) : (EXP + '/token/' + VIN);
      });
      if (cfg.LINKS?.SWAP) {
        setHref('link-swap', cfg.LINKS.SWAP);
        const mSwap = document.getElementById('m-link-swap');
        if (mSwap) mSwap.href = cfg.LINKS.SWAP;
      }

      // Drawer open/close
      const drawer = document.getElementById('drawer');
      document.getElementById('menu-toggle').addEventListener('click', () => {
        drawer.setAttribute('aria-hidden', drawer.getAttribute('aria-hidden') === 'true' ? 'false' : 'true');
      });
      document.getElementById('drawer-close').addEventListener('click', () => {
        drawer.setAttribute('aria-hidden', 'true');
      });

      // Desktop dropdowns
      document.querySelectorAll('.menu-item.has-sub').forEach(item => {
        const btn = item.querySelector('.menu-btn');
        btn?.addEventListener('click', (e) => {
          e.stopPropagation();
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          document.querySelectorAll('.menu-item.has-sub .menu-btn[aria-expanded="true"]').forEach(b=>{
            if (b !== btn) { b.setAttribute('aria-expanded','false'); b.parentElement.classList.remove('open'); }
          });
          btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
          item.classList.toggle('open', !expanded);
        });
      });
      document.addEventListener('click', () => {
        document.querySelectorAll('.menu-item.has-sub').forEach(i => {
          i.classList.remove('open');
          const b = i.querySelector('.menu-btn'); if (b) b.setAttribute('aria-expanded','false');
        });
      });

      // Mirror search desktop <-> mobile
      const si = document.getElementById('search-input');
      const sm = document.getElementById('m-search-input');
      const sync = (from, to) => from && to && from.addEventListener('input', ()=>{ to.value = from.value; });
      sync(si, sm); sync(sm, si);

      // Mirror main actions (app.js chỉ bind desktop ids)
      const map = [
        ['btn-connect','m-btn-connect'],
        ['btn-search','m-btn-search']
      ];
      map.forEach(([d,m])=>{
        const D=document.getElementById(d), M=document.getElementById(m);
        if (D && M) M.addEventListener('click', ()=> D.click());
      });
    })();
  </script>
</body>
</html>
