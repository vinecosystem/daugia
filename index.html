<!DOCTYPE html>
<html lang="vi">
<head>
  <!-- =========================================================
       daugia.vin â€” index.html (UI 2 tráº¡ng thÃ¡i)
       I.  ChÆ°a káº¿t ná»‘i vÃ­:
           1) Logo & slogan
           2) Ã” tÃ¬m kiáº¿m + nÃºt TÃ¬m
           3) NÃºt Káº¿t ná»‘i vÃ­
           4) GiÃ¡ VIN theo USD
           5) Danh sÃ¡ch cuá»™c Ä‘áº¥u giÃ¡ (read-only)
           6) Thanh Ä‘iá»u hÆ°á»›ng chÃ¢n trang: HÆ°á»›ng dáº«n, Swap, Há»£p Ä‘á»“ng, VIN token
       II. ÄÃ£ káº¿t ná»‘i vÃ­:
           - Náº¿u CHÆ¯A Ä‘Äƒng kÃ½: hiá»‡n nÃºt ÄÄƒng kÃ½ + sá»‘ dÆ° VIC/VIN
           - Náº¿u ÄÃƒ Ä‘Äƒng kÃ½: áº©n ÄÄƒng kÃ½, hiá»‡n nÃºt Táº¡o cuá»™c Ä‘áº¥u giÃ¡
           - Vá»›i má»—i auction:
             * Organizer: hiá»‡n nÃºt Cáº­p nháº­t vÃ­ Ä‘Ã£ cá»c
             * User Ä‘Ã£ Ä‘Äƒng kÃ½ vÃ  thuá»™c whitelist: hiá»‡n nÃºt Bá» giÃ¡
     ========================================================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>daugia.vin â€” Äáº¥u giÃ¡ minh báº¡ch trÃªn Blockchain</title>
  <meta name="description" content="Ná»n táº£ng Ä‘áº¥u giÃ¡ minh báº¡ch trÃªn blockchain Viction (VIC) â€” má»i thao tÃ¡c on-chain, cÃ´ng khai, chá»‘ng can thiá»‡p." />
  <link rel="icon" type="image/png" href="vin64.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Bá»• sung ráº¥t nhá» Ä‘á»ƒ cÄƒn layout má»›i (khÃ´ng phÃ¡ style.css cá»§a báº¡n) */
    .subnav {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 8px 20px;
    }
    .subnav a {
      color: var(--text-soft);
      text-decoration: none;
      margin-right: 16px;
      font-size: 0.9rem;
    }
    .toolbar {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-card);
    }
    .toolbar .search {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
    }
    .wallet-panel {
      display: none; /* hiá»‡n khi Ä‘Ã£ káº¿t ná»‘i vÃ­ */
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
    }
    .wallet-panel .grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 10px;
      align-items: center;
    }
    .actions-auth {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    .hidden { display: none !important; }
    .auction-actions {
      display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;
    }
    @media (max-width: 768px){
      .toolbar { grid-template-columns: 1fr; }
      .wallet-panel .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- =============== Header: Logo + slogan =============== -->
  <header class="nav">
    <div class="nav-left">
      <img id="logo-main" src="vin128.png" alt="daugia.vin logo" />
      <div class="brand">
        <h1 class="brand-title">daugia.vin</h1>
        <p class="brand-sub">Äáº¥u giÃ¡ minh báº¡ch trÃªn Blockchain</p>
      </div>
    </div>
    <div class="nav-right">
      <!-- GiÃ¡ VIN theo USD -->
      <div id="vin-price-chip" class="chip" title="GiÃ¡ VIN theo USD (tham chiáº¿u tá»« VIC/USDT)">
        1 VIN = <strong id="vinUsdValue">â€”</strong> USD
      </div>
      <!-- Tráº¡ng thÃ¡i máº¡ng -->
      <div id="network-badge" class="chip muted">ChÆ°a káº¿t ná»‘i</div>
      <!-- NÃºt káº¿t ná»‘i / ngáº¯t káº¿t ná»‘i -->
      <button id="btnConnect" class="btn primary">Káº¿t ná»‘i vÃ­</button>
      <button id="btnDisconnect" class="btn hidden">Ngáº¯t káº¿t ná»‘i</button>
    </div>
  </header>

  <!-- =============== Subnav (link HÆ°á»›ng dáº«n ngay dÆ°á»›i tiÃªu Ä‘á») =============== -->
  <div class="subnav">
    <a id="lnkGuideTop" href="#" rel="noreferrer">ğŸ“˜ HÆ°á»›ng dáº«n</a>
  </div>

  <!-- =============== Thanh cÃ´ng cá»¥: TÃ¬m kiáº¿m + GiÃ¡ + Káº¿t ná»‘i =============== -->
  <section class="toolbar">
    <!-- 2) Ã” tÃ¬m kiáº¿m -->
    <div class="search">
      <input id="searchQuery" class="input" type="text" placeholder="TÃ¬m theo tiÃªu Ä‘á»/Ä‘á»‹a chá»‰/ID/organizerâ€¦" />
      <button id="btnSearch" class="btn">TÃ¬m</button>
    </div>

    <!-- 4) GiÃ¡ VIN theo USD (nháº¯c láº¡i, gá»n) -->
    <div class="chip">VIN â‰ˆ <strong id="vinUsdValueMini">â€”</strong> USD</div>

    <!-- 3) NÃºt Ä‘Äƒng kÃ½ / táº¡o auction tÃ¹y tráº¡ng thÃ¡i -->
    <div class="actions-auth">
      <button id="btnRegister" class="btn hidden">ÄÄƒng kÃ½</button>
      <button id="btnCreateAuction" class="btn primary hidden">Táº¡o cuá»™c Ä‘áº¥u giÃ¡</button>
    </div>
  </section>

  <!-- =============== Panel vÃ­ (chá»‰ hiá»‡n khi Ä‘Ã£ káº¿t ná»‘i) =============== -->
  <section id="walletPanel" class="wallet-panel">
    <div class="grid">
      <div><strong>VÃ­:</strong> <span id="accountShort">â€”</span></div>
      <div><strong>Sá»‘ dÆ° VIC:</strong> <span id="vicBalance">â€”</span></div>
      <div><strong>Sá»‘ dÆ° VIN:</strong> <span id="vinBalance">â€”</span></div>
      <div class="actions-auth">
        <!-- Khi Ä‘Ã£ Ä‘Äƒng kÃ½: hiá»‡n nÃºt Táº¡o cuá»™c Ä‘áº¥u giÃ¡ á»Ÿ Ä‘Ã¢y thÃªm láº§n ná»¯a cho tiá»‡n -->
        <button id="btnCreateAuction2" class="btn primary hidden">Táº¡o cuá»™c Ä‘áº¥u giÃ¡</button>
      </div>
    </div>
    <div class="small"><a id="linkVicScan" class="muted" href="#" target="_blank" rel="noreferrer">Xem vÃ­ trÃªn VicScan</a></div>
  </section>

  <!-- =============== 5) Danh sÃ¡ch cuá»™c Ä‘áº¥u giÃ¡ (trang chÃ­nh) =============== -->
  <main class="container">
    <section class="card">
      <div class="card-head">
        <h3>Cuá»™c Ä‘áº¥u giÃ¡ Ä‘ang cÃ´ng bá»‘</h3>
        <p class="muted">Ai cÅ©ng xem Ä‘Æ°á»£c dá»¯ liá»‡u on-chain mÃ  khÃ´ng cáº§n káº¿t ná»‘i vÃ­.</p>
      </div>
      <div class="card-body">
        <div id="auctionList" class="grid-cards">
          <div class="skeleton">Äang táº£i dá»¯ liá»‡uâ€¦</div>
        </div>
      </div>
    </section>
  </main>

  <!-- =============== 6) Footer Nav (Ä‘áº·t cÃ¡c link yÃªu cáº§u) =============== -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-col">
        <h4>LiÃªn káº¿t nhanh</h4>
        <ul class="links">
          <li><a id="lnkGuideBottom" href="#" rel="noreferrer">ğŸ“˜ HÆ°á»›ng dáº«n</a></li>
          <li><a id="lnkSwap" href="https://fortunerolls.github.io/vicdex" target="_blank" rel="noreferrer">ğŸ” Swap VIN/VIC</a></li>
          <li><a id="lnkAuctionContract" href="#" target="_blank" rel="noreferrer">ğŸ“œ Há»£p Ä‘á»“ng Ä‘áº¥u giÃ¡</a></li>
          <li><a id="lnkVinToken" href="#" target="_blank" rel="noreferrer">ğŸ’  VIN Token</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Minh báº¡ch</h4>
        <p class="muted small">
          Má»i thao tÃ¡c Ä‘á»u ghi nháº­n on-chain, kiá»ƒm tra trÃªn VicScan báº¥t ká»³ lÃºc nÃ o.
        </p>
        <p class="muted small">
          Há»£p Ä‘á»“ng: <code id="auctionAddrText">â€”</code><br/>
          VIN token: <code id="vinAddrText">â€”</code>
        </p>
      </div>
      <div class="footer-col">
        <h4>ThÆ°Æ¡ng hiá»‡u</h4>
        <p class="muted small">Â© <span id="yearNow"></span> daugia.vin â€” All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- =============== Template tháº» auction (Ä‘á»ƒ app.js render) =============== -->
  <template id="tpl-auction-card">
    <div class="card">
      <div class="card-head">
        <h4 class="auc-title">TiÃªu Ä‘á» tÃ i sáº£n</h4>
        <p class="muted small">
          ID <span class="auc-id">#0</span> â€¢ Organizer:
          <a class="auc-organizer" href="#" target="_blank" rel="noreferrer">0xâ€¦</a>
        </p>
      </div>
      <div class="card-body">
        <!-- Thá»i gian, giÃ¡, cá»c, CIDâ€¦ -->
        <div class="auc-meta"></div>
        <!-- MÃ´ táº£, áº£nh, tÃ i liá»‡u IPFS (app.js sáº½ render tá»« CID) -->
        <div class="auc-detail"></div>
        <!-- HÃ nh Ä‘á»™ng theo vai trÃ² -->
        <div class="auction-actions">
          <!-- Cho organizer -->
          <button class="btn ghost btn-update-whitelist hidden" data-auction-id="">Cáº­p nháº­t vÃ­ Ä‘Ã£ cá»c</button>
          <!-- Cho bidder (Ä‘Ã£ whitelist) -->
          <button class="btn btn-bid hidden" data-auction-id="">Bá» giÃ¡</button>
        </div>
      </div>
      <div class="card-foot">
        <a class="btn ghost auc-open-onchain" href="#" target="_blank" rel="noreferrer">Má»Ÿ trÃªn VicScan</a>
      </div>
    </div>
  </template>

  <!-- =============== Script cáº¥u hÃ¬nh & thÆ° viá»‡n =============== -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" crossorigin="anonymous"></script>
  <script>
    // Cáº¥u hÃ¬nh cá»‘ Ä‘á»‹nh (Ä‘á»“ng bá»™ vá»›i app.js)
    window.DGV_CONFIG = {
      CHAIN_ID_HEX: "0x58", // Viction chainId = 88
      RPC_URL: "https://rpc.viction.xyz",
      EXPLORER: "https://vicscan.xyz",
      AUCTION_ADDR: "0x1765e20ecB8cD78688417A6d4123f2b899775599",
      VIN_ADDR: "0x941F63807401efCE8afe3C9d88d368bAA287Fac4"
    };

    // Set link tÄ©nh & nÄƒm
    (function initStatic(){
      const { EXPLORER, AUCTION_ADDR, VIN_ADDR } = window.DGV_CONFIG;
      document.getElementById('yearNow').textContent = new Date().getFullYear();
      document.getElementById('auctionAddrText').textContent = AUCTION_ADDR;
      document.getElementById('vinAddrText').textContent = VIN_ADDR;

      // Footer links
      document.getElementById('lnkAuctionContract').href = `${EXPLORER}/address/${AUCTION_ADDR}`;
      document.getElementById('lnkVinToken').href       = `${EXPLORER}/address/${VIN_ADDR}`;
    })();

    // CÃ¡c link "HÆ°á»›ng dáº«n" (app.js sáº½ báº¯t sá»± kiá»‡n Ä‘á»ƒ má»Ÿ modal/hiá»ƒn thá»‹ markdown mota-daugia.md)
    document.getElementById('lnkGuideTop').addEventListener('click', e => { e.preventDefault(); window.dispatchEvent(new CustomEvent('open-guide')); });
    document.getElementById('lnkGuideBottom').addEventListener('click', e => { e.preventDefault(); window.dispatchEvent(new CustomEvent('open-guide')); });

    // CÃ¡c nÃºt tÃ¡c vá»¥ (Ä‘á»ƒ app.js gáº¯n logic)
    document.getElementById('btnSearch').addEventListener('click', () => window.dispatchEvent(new CustomEvent('do-search')));
    document.getElementById('btnRegister').addEventListener('click', () => window.dispatchEvent(new CustomEvent('do-register')));
    document.getElementById('btnCreateAuction').addEventListener('click', () => window.dispatchEvent(new CustomEvent('open-create')));
    document.getElementById('btnCreateAuction2').addEventListener('click', () => window.dispatchEvent(new CustomEvent('open-create')));
    document.getElementById('btnConnect').addEventListener('click', () => window.dispatchEvent(new CustomEvent('do-connect')));
    document.getElementById('btnDisconnect').addEventListener('click', () => window.dispatchEvent(new CustomEvent('do-disconnect')));

    // Äá»“ng bá»™ 2 nÆ¡i hiá»ƒn thá»‹ giÃ¡ (chip trÃªn & mini)
    window.addEventListener('vin-price', (ev) => {
      const p = ev.detail?.priceUsd;
      if (typeof p === 'number' && isFinite(p)) {
        document.getElementById('vinUsdValue').textContent = p.toFixed(2);
        document.getElementById('vinUsdValueMini').textContent = p.toFixed(2);
      }
    });

    // Äá»“ng bá»™ tráº¡ng thÃ¡i vÃ­/Ä‘Äƒng kÃ½/chuá»—i
    window.addEventListener('wallet-state', (ev) => {
      const s = ev.detail || {};
      // Network badge
      document.getElementById('network-badge').textContent = s.networkName || 'Viction';
      // NÃºt connect/disconnect
      document.getElementById('btnConnect').classList.toggle('hidden', !!s.connected);
      document.getElementById('btnDisconnect').classList.toggle('hidden', !s.connected);
      // Panel vÃ­
      document.getElementById('walletPanel').style.display = s.connected ? 'block' : 'none';
      document.getElementById('accountShort').textContent = s.accountShort || 'â€”';
      document.getElementById('vicBalance').textContent   = s.vicBalance   ?? 'â€”';
      document.getElementById('vinBalance').textContent   = s.vinBalance   ?? 'â€”';
      if (s.accountExplorer) document.getElementById('linkVicScan').href = s.accountExplorer;

      // Quyá»n nÄƒng theo Ä‘Äƒng kÃ½
      const registered = !!s.registered;
      document.getElementById('btnRegister').classList.toggle('hidden', !s.connected || registered);
      document.getElementById('btnCreateAuction').classList.toggle('hidden', !s.connected || !registered);
      document.getElementById('btnCreateAuction2').classList.toggle('hidden', !s.connected || !registered);
    });

    // App.js sáº½ render danh sÃ¡ch auction vÃ o #auctionList dá»±a trÃªn <template id="tpl-auction-card">
  </script>

  <!-- App logic -->
  <script src="app.js"></script>
</body>
</html>
