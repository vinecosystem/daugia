<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>daugia.vin — minh bạch trên blockchain</title>

  <!-- Favicon / Logos -->
  <link rel="icon" type="image/png" sizes="64x64" href="vin64.png" />
  <meta name="theme-color" content="#11141a" />

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="container header">
    <div class="brand">
      <img src="vin128.png" alt="daugia.vin" class="logo-img" />
      <div>
        <div class="logo">daugia.vin</div>
        <div class="slogan">minh bạch trên blockchain</div>
      </div>
    </div>
    <div class="actions">
      <div class="vinusd">1 VIN ≈ <span id="vinUsd">--</span> USD</div>
      <button id="connectBtn" class="btn primary">Kết nối ví</button>
      <div id="accountInfo" class="account hidden">
        <span id="accountAddr">0x…</span>
        <span class="balance">VIN: <b id="vinBal">-</b> | VIC: <b id="vicBal">-</b></span>
      </div>
      <button id="registerBtn" class="btn warn hidden">Đăng ký (0.001 VIN)</button>
      <button id="createAuctionBtn" class="btn success hidden">Tạo cuộc đấu giá</button>
    </div>
  </header>

  <main class="container">
    <section class="searchBar">
      <input id="searchInput" type="text" placeholder="Tìm kiếm theo mô tả ngắn hoặc ví tổ chức…" />
      <select id="statusFilter">
        <option value="">Tất cả trạng thái</option>
        <option value="0">Chưa diễn ra</option>
        <option value="1">Đang diễn ra</option>
        <option value="2">Đã kết thúc</option>
        <option value="3">Đã chốt</option>
      </select>
      <button id="searchBtn" class="btn">Tìm</button>
      <button id="clearSearchBtn" class="btn ghost">X</button>
    </section>

    <section id="auctionsList" class="list">
      <!-- JS sẽ render danh sách phiên đấu giá ở đây -->
    </section>
  </main>

  <footer class="container footer">
    <nav class="links">
      <a id="contractLink" href="https://vicscan.xyz/address/0x44DeC3CBdF3448F05f082050aBC9697d8224f511#code" target="_blank" rel="noreferrer">Hợp đồng đấu giá</a>
      <a href="https://vicscan.xyz/token/0x941F63807401efCE8afe3C9d88d368bAA287Fac4" target="_blank" rel="noreferrer">VIN token</a>
      <a href="https://vicscan.xyz" target="_blank" rel="noreferrer">Swap VIN/VIC</a>
      <a href="#" id="guideLink">Hướng dẫn</a>
    </nav>
    <div class="disclaimer">
      ⚖️ Đây là giao diện phi tập trung. Mọi logic & quỹ do smart contract trên Viction kiểm soát.
      Nền tảng <b>không thu tiền cọc</b> và <b>không giữ tiền bán tài sản</b>; chỉ tạo cơ chế đấu giá minh bạch & công bằng.
    </div>
  </footer>

  <!-- Modal tạo cuộc đấu giá -->
  <dialog id="createDialog" class="dialog">
    <form method="dialog" class="dialog-card" id="createForm">
      <h3>Tạo cuộc đấu giá</h3>
      <label>Mô tả ngắn (≤ 280 ký tự) <input id="fSummary" maxlength="280" required /></label>
      <label>Thông báo đấu giá (URL) <input id="fThongBao" type="url" required /></label>
      <label>Quy chế đấu giá (URL) <input id="fQuiChe" type="url" required /></label>
      <div class="grid2">
        <label>Hạn cập nhật whitelist (dd/mm/yyyy hh:mm)
          <input id="fCutoff" placeholder="dd/mm/yyyy hh:mm" required />
        </label>
        <label>Bắt đầu đấu giá (dd/mm/yyyy hh:mm)
          <input id="fStart" placeholder="dd/mm/yyyy hh:mm" required />
        </label>
      </div>
      <label>Kết thúc đấu giá (dd/mm/yyyy hh:mm)
        <input id="fEnd" placeholder="dd/mm/yyyy hh:mm" required />
      </label>
      <div class="grid2">
        <label>Giá khởi điểm (VND) <input id="fStartPrice" inputmode="numeric" required /></label>
        <label>Bước giá (VND) <input id="fStep" inputmode="numeric" required /></label>
      </div>
      <div class="hint">Khi bấm “Đăng”, ví sẽ ký giao dịch và trừ phí 0.001 VIN.</div>
      <menu>
        <button value="cancel" class="btn ghost">Hủy</button>
        <button id="submitCreate" value="default" class="btn success">Đăng</button>
      </menu>
    </form>
  </dialog>

  <!-- Template card -->
  <template id="auctionCardTpl">
    <article class="card">
      <div class="card-head">
        <h4 class="title"></h4>
        <button class="btn small ghost detailBtn">Chi tiết</button>
      </div>
      <div class="card-body hidden">
        <div class="cols">
          <div class="col content">
            <div class="snippet"></div>
            <div class="doc-links">
              <a class="thongbao" href="#" target="_blank">Mở Thông báo</a>
              <a class="quiche" href="#" target="_blank">Mở Quy chế</a>
            </div>
          </div>
          <div class="col info">
            <div><b>Thời gian:</b> <span class="time"></span></div>
            <div><b>Hạn whitelist:</b> <span class="cutoff"></span></div>
            <div><b>Giá khởi điểm:</b> <span class="startPrice"></span></div>
            <div><b>Bước giá:</b> <span class="step"></span></div>
            <div><b>Giá hiện thời:</b> <span class="current"></span></div>
            <div><b>Ví đang dẫn:</b> <span class="leader"></span></div>
            <details class="wl">
              <summary>Danh sách ví đã cọc</summary>
              <div class="wlList"></div>
            </details>
          </div>
        </div>
        <div class="actions-row">
          <button class="btn joinBtn">Tham gia</button>
          <button class="btn ghost backBtn">Trở về danh sách</button>
          <button class="btn warn regBtn hidden">Đăng ký (0.001 VIN)</button>
          <button class="btn success createBtn hidden">Tạo cuộc đấu giá</button>
          <button class="btn updateWlBtn hidden">Cập nhật ví đã cọc</button>
          <button class="btn bidBtn hidden">Bỏ giá</button>
        </div>
        <div class="status"></div>
      </div>
    </article>
  </template>

  <!-- Ethers v6 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.min.js"></script>
  <!-- App -->
  <script src="./app.js"></script>

  <!-- Giá 1 VIN ≈ USD (VIC/USDT * 100) -->
  <script>
    async function updateVinUsd() {
      const el = document.getElementById('vinUsd');
      try {
        const r = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=VICUSDT', { cache: 'no-store' });
        if (!r.ok) throw new Error('fetch VICUSDT failed');
        const data = await r.json();
        const vicUsd = parseFloat(data.price);
        if (!isFinite(vicUsd)) throw new Error('invalid price');
        const vinUsd = vicUsd * 100;
        el.textContent = vinUsd.toFixed(2);
      } catch (e) {
        el.textContent = '--';
      }
    }
    updateVinUsd();
    setInterval(updateVinUsd, 60000); // 60s
  </script>
</body>
</html>
