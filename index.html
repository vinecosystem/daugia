<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>daugia.vin — Đấu giá minh bạch trên blockchain</title>
  <meta name="description" content="DApp đấu giá on-chain trên Viction (VIC). Đăng ký, tìm kiếm, theo dõi và xem các cuộc đấu giá minh bạch — công bằng — bất biến." />

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="vin64.png" />
  <link rel="icon" type="image/png" sizes="64x64" href="vin64.png" />
  <link rel="apple-touch-icon" sizes="128x128" href="vin128.png" />
  <link rel="shortcut icon" href="vin64.png" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Top Navigation -->
  <header class="nav">
    <div class="nav__left">
      <img id="logo" src="vin128.png" alt="VIN" />
      <div class="brand">
        <h1>daugia.vin</h1>
        <p class="tagline">Minh bạch & Công bằng trên blockchain</p>
      </div>
    </div>
    <div class="nav__right">
      <!-- Giá VIN (thay cho VIC: OK) -->
      <div class="net-pill" id="vin-price-pill">
        <span id="vin-price">đang tải…</span>
      </div>

      <!-- Wallet chip (ẩn trước khi kết nối) -->
      <div id="wallet-chip" class="wallet-chip hidden">
        <span id="wallet-address">0x…</span>
        <span class="sep">•</span>
        <span id="bal-vic">VIC: -</span>
        <span class="sep">•</span>
        <span id="bal-vin">VIN: -</span>
      </div>

      <button id="btn-connect" class="btn btn-primary" title="Kết nối ví (Viction)">Kết nối ví</button>
      <button id="btn-disconnect" class="btn btn-secondary hidden" title="Ngắt kết nối ví">Ngắt kết nối</button>
    </div>
  </header>

  <!-- Slogan -->
  <section class="hero">
    <div class="hero__content">
      <h2>Minh bạch — Công bằng — Bất biến</h2>
    </div>
  </section>

  <!-- Toolbar -->
  <section class="toolbar">
    <div class="toolbar__row" style="flex-wrap:wrap; gap:10px; align-items:end; max-width:1080px; margin:0 auto;">

      <!-- Đăng ký — ẩn khi chưa kết nối; hiện khi đã kết nối & chưa đăng ký -->
      <button id="btn-register" class="btn btn-outline hidden" title="Đăng ký tổ chức — phí 1$ VIN">Đăng ký (1$ VIN)</button>

      <!-- Tìm kiếm theo địa chỉ ví người tạo cuộc đấu giá -->
      <div class="field" style="max-width:420px; min-width:260px;">
        <label for="inp-organizer">Tìm kiếm (theo địa chỉ ví người tạo cuộc đấu giá)</label>
        <div style="display:flex; gap:6px;">
          <input id="inp-organizer" type="text" placeholder="0x… người tạo" />
          <button id="btn-search" class="btn">Tìm</button>
        </div>
      </div>

      <!-- Theo dõi ví để lọc danh sách -->
      <div class="field" style="max-width:520px; min-width:260px;">
        <label for="inp-follow">Theo dõi ví (lọc danh sách theo organizer)</label>
        <div style="display:flex; gap:6px;">
          <input id="inp-follow" type="text" placeholder="0x… địa chỉ ví organizer" />
          <button id="btn-follow-add" class="btn btn-secondary">Theo dõi</button>
          <button id="btn-follow-clear" class="btn btn-ghost" title="Xóa danh sách theo dõi">Xóa</button>
        </div>
        <small class="muted" id="follow-hint">Chưa có ví theo dõi</small>
      </div>

    </div>
  </section>

  <!-- Sub-status row: chỉ còn bộ lọc + phí nền tảng -->
  <section style="max-width:1080px; margin:6px auto 0; padding:0 16px; display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
    <span class="muted">Trạng thái:</span>
    <span id="filter-pill" class="badge hidden"></span>
    <span class="sep">•</span>
    <span class="muted">Phí nền tảng (VIN): <strong id="platform-fee" class="muted">…</strong></span>
  </section>

  <!-- Danh sách cuộc đấu giá -->
  <main class="container" id="auction-list"></main>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <footer class="footer">
    <div class="footer__row">
      <a href="https://t.me/vinecosystem" target="_blank" rel="noopener">Telegram</a>
      <span class="sep">•</span>
      <a href="https://x.com/vinecosystem" target="_blank" rel="noopener">X</a>
      <span class="sep">•</span>
      <a href="https://github.com/vinecosystem" target="_blank" rel="noopener">GitHub</a>
      <span class="sep">•</span>
      <a href="https://vicscan.xyz/address/0x1765e20ecB8cD78688417A6d4123f2b899775599" target="_blank" rel="noopener">Hợp đồng đấu giá</a>
      <span class="sep">•</span>
      <a href="https://vicscan.xyz/token/0x941F63807401efCE8afe3C9d88d368bAA287Fac4" target="_blank" rel="noopener">VIN token</a>
      <span class="sep">•</span>
      <a href="https://ipfs.io/ipfs/bafybeigooqte3w5m3rok2r7c5czep2flsfeocwjpzzid3vxszdyib3rjpi" target="_blank" rel="noopener">Swap VIN/VIC</a>
      <span class="sep">•</span>
      <a href="https://docs.google.com/document/d/1MH7DPggKAGPQkdC2UuD4Afm9E_QOMbOr/edit" target="_blank" rel="noopener">Hướng dẫn</a>
    </div>
    <div class="footer__row muted">
      daugia.vin — dữ liệu on-chain • không lưu trữ thông tin cá nhân • giao dịch ký trên ví của bạn
    </div>
  </footer>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" crossorigin="anonymous"></script>

  <!-- Price Script: lấy VIC/USDT từ Binance rồi quy đổi VIN = VIC * 100 -->
  <script>
    const BINANCE_API_URL = "https://api.binance.com/api/v3/ticker/price?symbol=VICUSDT";
    async function updateVinPrice() {
      const el = document.getElementById("vin-price");
      if (!el) return;
      try {
        const res = await fetch(BINANCE_API_URL, { cache: "no-store" });
        const data = await res.json();
        const vicPrice = parseFloat(data.price);
        if (Number.isFinite(vicPrice)) {
          const vinPrice = vicPrice * 100; // theo yêu cầu: 1 VIN = 100 * VIC
          el.textContent = `1 VIN = ${vinPrice.toFixed(2)} USD`;
        } else {
          el.textContent = "Price unavailable";
        }
      } catch (err) {
        console.error("Failed to fetch VIN price:", err);
        const ts = new Date().toLocaleTimeString();
        el.textContent = `Price unavailable (${ts})`;
      }
    }
    document.addEventListener("DOMContentLoaded", updateVinPrice);
    setInterval(updateVinPrice, 60000);
  </script>

  <!-- App script (v5: connect/disconnect + register-guard + follow) -->
  <script src="app.js"></script>
</body>
</html>
